# 数据链路层

### 基本概念
##### 链路
**链路**是一条点到点的物理线路段，中间没有任何其他的交换节点。  
一条链路只是一条通路的一个组成部分。
##### 数据链路
除了物理线路外，还必须有通信协议来控制这些数据的传输。若把实现这些协议的硬件和软件加到链路上，就构成了**数据链路**。
##### 帧
数据链路层传输的是**帧**。

### 基本问题
三个基本问题：
* 封装成帧
* 透明传输
* 差错控制

#### 封装成帧
封装成帧就是在一段数据的前后分别添加首部和尾部，然后就构成了一个帧。首部和尾部确定了帧的界限。
![2.数据链路层+截屏2021-02-01 22.18.58](https://raw.githubusercontent.com/loli0con/picgo/master/images/2.%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%2B%E6%88%AA%E5%B1%8F2021-02-01%2022.18.58.png%2B2021-02-01-22-19-08)
> MTU最大不能超过1500字节
* SOH，Start Of Header，帧开始符
* EOT，End Of Transmission，帧结束符
* 设备会丢弃掉不完整的帧

#### 透明传输
##### 存在的问题
如果数据中的某个字节的二进制代码恰好和SOH或EOT一样，数据链路层就会错误地“找到帧的边界”。
![2.数据链路层+截屏2021-02-01 22.25.07](https://raw.githubusercontent.com/loli0con/picgo/master/images/2.%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%2B%E6%88%AA%E5%B1%8F2021-02-01%2022.25.07.png%2B2021-02-01-22-25-31)
##### 解决的办法
字节填充或字符填充。
![2.数据链路层+截屏2021-02-01 22.25.23](https://raw.githubusercontent.com/loli0con/picgo/master/images/2.%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%2B%E6%88%AA%E5%B1%8F2021-02-01%2022.25.23.png%2B2021-02-01-22-25-31)

#### 差错控制
##### 存在的问题
在传输过程中可能会产生比特差错，1可能会变成0而0也可能变成1。
> 在一段时间内，传输错误的比特占所传输比特总数的比率称为误码率 BER (Bit Error Rate)。

##### 解决的办法
在数据链路层传送的帧中，广泛使用了循环冗余检验CRC的检错技术。
###### 循环冗余检验的原理
1. 在发送端，先把数据划分为组。假定每组k个比特。
2. 假设待传送的一组数据M=101001(现在k=6)。我们在M的后面再添加供差错检测用的n位**冗余码**一起发送。
3. 计算冗余码
   1. 用二进制的模2运算进行2n乘M的运算，这相当于在M后面添加n个0。
   2. 得到的(k+n)位的数除以事先选定好的长度为(n+1)位的除数P，得出商是Q而余数是R，余数R比除数P少1位，即R是n位。
   3. 将余数R作为冗余码拼接在数据M后面发送出去。
![2.数据链路层+截屏2021-02-01 22.37.35](https://raw.githubusercontent.com/loli0con/picgo/master/images/2.%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%2B%E6%88%AA%E5%B1%8F2021-02-01%2022.37.35.png%2B2021-02-01-22-37-52)
        > 运算时里面的减法：相同的得0，不同的得1  
        > P除数是网卡自动协商的，用的是数据链路层的协议
4. 接收端对收到的每一帧进行CRC检验
    * 若得出的余数R=0，则判定这个帧没有差错，就接受。
    * 若余数R不等于0，则判定这个帧有差错，就丢弃。

###### FCS
在数据后面添加上的冗余码称为帧检验序列FCS (Frame Check Sequence)。
* CRC是一种常用的检错方法，而FCS是添加在数据后面的冗余码。
* FCS可以用CRC这种方法得出，但CRC并非用来获得 FCS的唯一方法。
##### 注意事项
* 仅用循环冗余检验CRC差错检测技术只能做到无差错接受。
* 要做到“可靠传输”(即发送什么就收到什么)就必须再加上确认和重传机制。
* 在数据链路层使用CRC检验，能够实现无比特差错的传输，但这还不是可靠传输。

### 信道
数据链路层使用的信道主要是：
* 点到点信道
* 广播信道
#### 点对点信道

#### 广播信道

### 以太局域网
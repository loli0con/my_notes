# 数据链路层

### 基本概念
##### 链路
**链路**是一条点到点的物理线路段，中间没有任何其他的交换节点。  
一条链路只是一条通路的一个组成部分。
##### 数据链路
除了物理线路外，还必须有通信协议来控制这些数据的传输。若把实现这些协议的硬件和软件加到链路上，就构成了**数据链路**。
##### 帧
数据链路层传输的是**帧**。

### 基本问题
三个基本问题：
* 封装成帧
* 透明传输
* 差错控制

#### 封装成帧
封装成帧就是在一段数据的前后分别添加首部和尾部，然后就构成了一个帧。首部和尾部确定了帧的界限。
![2.数据链路层+截屏2021-02-01 22.18.58](https://raw.githubusercontent.com/loli0con/picgo/master/images/2.%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%2B%E6%88%AA%E5%B1%8F2021-02-01%2022.18.58.png%2B2021-02-01-22-19-08)
> MTU，Maximum transmission unit，最大传输单元：最大不能超过1500字节
* SOH，Start Of Header，帧开始符
* EOT，End Of Transmission，帧结束符
* 设备会丢弃掉不完整的帧

#### 透明传输
##### 存在的问题
如果数据中的某个字节的二进制代码恰好和SOH或EOT一样，数据链路层就会错误地“找到帧的边界”。
![2.数据链路层+截屏2021-02-01 22.25.07](https://raw.githubusercontent.com/loli0con/picgo/master/images/2.%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%2B%E6%88%AA%E5%B1%8F2021-02-01%2022.25.07.png%2B2021-02-01-22-25-31)
##### 解决的办法
字节填充或字符填充。
###### 字节填充
* *发送端*的数据链路层在数据中出现控制字符“SOH”或“EOT”的前面*插入一个转义字符“ESC”* (其十六进制编码是1B)。
* *接收端*的数据链路层在将数据送往网络层之前*删除插入的转义字符*。
* 如果转义字符也出现在数据当中，那么应在*转义字符前面插入一个转义字符ESC*。当接收端收到连续的两个转义字符时，就删除其中前面的一个。
![2.数据链路层+截屏2021-02-01 22.25.23](https://raw.githubusercontent.com/loli0con/picgo/master/images/2.%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%2B%E6%88%AA%E5%B1%8F2021-02-01%2022.25.23.png%2B2021-02-01-22-25-31)

#### 差错控制
##### 存在的问题
在传输过程中可能会产生比特差错，1可能会变成0而0也可能变成1。
> 在一段时间内，传输错误的比特占所传输比特总数的比率称为误码率 BER (Bit Error Rate)。

##### 解决的办法
在数据链路层传送的帧中，广泛使用了**循环冗余检验CRC**的检错技术。
###### 循环冗余检验的原理
1. 在发送端，先把数据划分为组。假定每组k个比特。
2. 假设待传送的一组数据M=101001(现在k=6)。我们在M的后面再添加供差错检测用的n位**冗余码**一起发送。
3. 计算冗余码
   1. 用二进制的模2运算进行2^n乘M的运算，这相当于在M后面添加n个0。
   2. 得到的(k+n)位的数除以事先选定好的长度为(n+1)位的除数P，得出商是Q而余数是R，余数R比除数P少1位，即R是n位。
   3. 将余数R作为冗余码拼接在数据M后面发送出去。
![2.数据链路层+截屏2021-02-01 22.37.35](https://raw.githubusercontent.com/loli0con/picgo/master/images/2.%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%2B%E6%88%AA%E5%B1%8F2021-02-01%2022.37.35.png%2B2021-02-01-22-37-52)
        > 运算时里面的减法：相同的得0，不同的得1  
        > P除数是网卡自动协商的，用的是数据链路层的协议
4. 接收端对收到的每一帧进行CRC检验
    * 若得出的余数R=0，则判定这个帧没有差错，就接受。
    * 若余数R不等于0，则判定这个帧有差错，就丢弃。

###### FCS
在数据后面添加上的冗余码称为帧检验序列FCS (Frame Check Sequence)。
* CRC是一种常用的检错方法，而FCS是添加在数据后面的冗余码。
* FCS可以用CRC这种方法得出，但CRC并非用来获得FCS的唯一方法。
##### 注意事项
* 仅用循环冗余检验CRC差错检测技术只能做到无差错接受。
* 要做到“可靠传输”(即发送什么就收到什么)就必须再加上确认和重传机制。
* 在数据链路层使用CRC检验，能够实现无比特差错的传输，但这还不是可靠传输。

### 信道
数据链路层使用的信道主要是：
* 点到点信道：使用PPP协议
* 广播信道：使用CSMA/CD协议
#### 点到点信道
对于点对点的链路，目前使用得最广泛的数据链路层协议是点对点**协议 PPP** (Point-to-Point Protocol)。

##### PPP协议应该满足的要求
* 简单
* 封装成帧
* 透明性
* 多种网络层协议
* 多种类型链路
* 差错检测
* 检测连接状态
* 最大传送单元
* 网络层地址协商
* 数据压缩协商

##### PPP协议的组成
PPP协议有三个组成部分:
1. 数据链路层协议可以用于异步串行或同步串行介质，含有将IP数据报封装到串行链路的方法。
2. 它使用链路控制协议 LCP (Link Control Protocol) 建立并维护数据链路连接。
3. 网络控制协议 NCP (Network Control Protocol) 允许在点到点连接上使用多种网络层协议。

##### PPP协议的帧格式
![2.数据链路层+截屏2021-02-02 13.43.18](https://raw.githubusercontent.com/loli0con/picgo/master/images/2.%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%2B%E6%88%AA%E5%B1%8F2021-02-02%2013.43.18.png%2B2021-02-02-13-44-05)
* PPP是面向字节的，所有的PPP帧的长度都是整数字节。
* 标志字段 F = 0x7E，帧头和帧尾的标识字段。
* 地址字段 A 只置为 0xFF，表示传输目标的地址，但由于是点到点通信，所以写啥都没有意义，于是就固定为FF。
* 控制字段 C 通常置为 0x03，固定的值。

##### 透明传输问题
* 当 PPP 用在同步传输链路时，协议规定采用硬件来完成比特填充。
* 当 PPP 用在异步传输时，就使用一种特殊的字符填充法。

###### 字符填充
![2.数据链路层+截屏2021-02-02 13.50.03](https://raw.githubusercontent.com/loli0con/picgo/master/images/2.%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%2B%E6%88%AA%E5%B1%8F2021-02-02%2013.50.03.png%2B2021-02-02-13-50-14)

###### 零比特填充
* PPP协议用在SONET/SDH链路时，使用同步传输(一连串的比特连续传送)。这时PPP协议采用零比特填充方法来实现透明传输。
* 在发送端，只要发现有5个连续1，则立即填入一个0。
* 接收端对帧中的比特流进行扫描。每当发现5个连续1时，就把这5个连续1后的一个0删除。

![2.数据链路层+截屏2021-02-02 13.53.49](https://raw.githubusercontent.com/loli0con/picgo/master/images/2.%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%2B%E6%88%AA%E5%B1%8F2021-02-02%2013.53.49.png%2B2021-02-02-13-56-07)

##### PPP协议的工作状态
1. 当用户拨号接入ISP时，路由器的调制解调器对拨号做出确认，并建立一条物理连接。
2. PC机向路由器发送一系列的LCP分组(封装成多个PPP帧)。
3. 这些分组及其响应选择一些PPP参数，并进行网络层配置，NCP给新接入的PC机分配一个临时的IP地址，使PC机成为因特网上的一个主机。
4. 通信完毕时，NCP释放网络层连接，收回原来分配出去的IP地址。接着，LCP释放数据链路层连接。最后释放的是物理层的连接。

![2.数据链路层+截屏2021-02-02 14.18.32](https://raw.githubusercontent.com/loli0con/picgo/master/images/2.%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%2B%E6%88%AA%E5%B1%8F2021-02-02%2014.18.32.png%2B2021-02-02-14-18-53)

#### 广播信道
##### 局域网的拓扑结构
![2.数据链路层+截屏2021-02-02 14.22.25](https://raw.githubusercontent.com/loli0con/picgo/master/images/2.%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%2B%E6%88%AA%E5%B1%8F2021-02-02%2014.22.25.png%2B2021-02-02-14-22-33)

##### 局域网的特点与优点
局域网最主要的特点是:
* 网络为一个单位所拥有;
* 地理范围和站点数目均有限。

局域网具有如下主要优点:
* 具有**广播功能**，从一个站点可很方便地访问全网
* 局域网上的主机可共享连接在局域网上的各种硬件和软件资源。
* 便于系统的扩展和逐渐地演变，各设备的位置可灵活调整和改变。
* 提高了系统的可靠性、可用性和残存性。

##### 共享通信媒体
静态划分信道：
* 频分复用
* 时分复用
* 波分复用
* 码分复用
> 静态信道划分在上一章节物理层中提到

动态媒体接入控制(多点接入)：
* 随机接入（**主要被以太网采用**）
* 受控接入，如多点线路探询(polling)，或轮询。（*目前已不被采用*）

##### 认识以太网
最初的以太网是将许多计算机都连接到一根总线上。当初认为这样的连接方法既简单又可靠，因为总线上没有有源器件。
![2.数据链路层+截屏2021-02-02 14.31.35](https://raw.githubusercontent.com/loli0con/picgo/master/images/2.%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%2B%E6%88%AA%E5%B1%8F2021-02-02%2014.31.35.png%2B2021-02-02-14-31-46)

优点：
* 不用划分信道，谁都可以通信。

缺点：
* B和D通信，所有机器都能收到，此时线路被占用，因此整个只能同时有一个机器发数据&另一个机器收数据。
* 安全性差，B和D通信，所有的机器都收到，可以使用抓包软件获得B给D发的数据。

##### 以太网的通信协议
CSMA/CD协议：Carrier Sense Multiple Access with Collision Detection
> 中文翻译：载波监听多点接入 / 碰撞检测

* “多点接入”表示许多计算机以多点接入的方式连接在一根总线上。
* “载波监听”是指每一个站在发送数据之前先要检测一下总线上是否有其他计算机在发送数据，如果有，则暂时不要发送数据，以免发生碰撞。
> “载波监听”就是用电子技术检测总线上有没有其他计算机发送的数据信号。
* “碰撞检测”就是计算机边发送数据边检测信道上的信号电压大小。

##### 碰撞检测
当几个站同时在总线上发送数据时，总线上的信号电压摆动值将会增大(互相叠加)。当一个站检测到的信号电压摆动值超过一定的门限值时，就认为总线上至少有两个站同时在发送数据，表明产生了碰撞。所谓“碰撞”就是发生了冲突。因此“碰撞检测”也称为“**冲突检测**”。

![2.数据链路层+截屏2021-02-02 14.40.21](https://raw.githubusercontent.com/loli0con/picgo/master/images/2.%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%2B%E6%88%AA%E5%B1%8F2021-02-02%2014.40.21.png%2B2021-02-02-14-40-33)

##### CSMA/CD重要特性
* 使用 CSMA/CD协议的以太网不能进行全双工通信而只能进行半双工通信。
* 每个站在发送数据之后的一小段时间内，存在着遭遇碰撞的可能性。这种发送的不确定性使整个以太网的平均通信量远小于以太网的最高数据率。

##### 争用期
* 最先发送数据帧的站，在发送数据帧后至多经过时间 2t (两倍的端到端往返时延)就可知道发送的数据帧是否遭受了碰撞。
* 经过争用期这段时间还没有检测到碰撞，才能肯定这次发送不会发生碰撞。


> 上面提到的“t”，其实是另一个符号，由于无法表示，所以这里使用形状比较相似的“t”来表示。

###### 争用期的长度
* 以太网的端到端往返时延 2t 称为争用期，或碰撞窗口。通常，10 Mbit/s 以太网取 51.2 us 为争用期的长度。
> 其中us表示微秒，  
> [为什么以太网把争用期定为51.2us?](https://zhidao.baidu.com/question/142404783.html)
* 对于 10 Mbit/s 以太网，在争用期内可发送 512 bit，即 64 字节。
* 以太网在发送数据时，若前 64 字节没有发生冲突，则后续的数据就不会发生冲突。

###### 最短有效帧长
* 如果发生冲突，就一定是在发送的前 64 字节之内。
* 由于一检测到冲突就立即中止发送，这时已经 发送出去的数据一定小于 64 字节。
* 以太网规定了最短有效帧长为 64 字节，凡长度小于 64 字节的帧都是由于冲突而异常中止的无效帧。

##### 解决冲突
发生碰撞的站在停止发送数据后，要推迟(退避)一个随机时间才能再发送数据。这里用到的是**二进制指数类型退避算法**，下面是其描述：
* 基本退避时间取为争用期 2t。
* 确定参数K，k = Min[重传次数, 10]
* 从整数集合 [0, 1, ... , (2^k - 1)] 中随机地取出一个数，记为r。重传所需的时延就是 r 倍的基本退避时间。
* 当重传达 16 次仍不能成功时即丢弃该帧，并向高层报告。


### 以太局域网
#### 以太网的两个标准
* DIX Ethernet V2 是世界上第一个局域网产品(以太网)的规约。
* IEEE 802.3 是第一个 IEEE 的以太网标准。
> DIX Ethernet V2 标准与 IEEE 的 802.3 标准只有很小的差别，因此可以将 802.3 局域网简称 为“以太网”。严格说来，“以太网”应当是指符合 DIX Ethernet V2 标准的局域网 。

#### 以太网与数据链路层的两个子层
为了使数据链路层能更好地适应多种局域网标准，IEEE 802 委员会就将局域网的数据链路层拆成两个子层:
* 逻辑链路控制 LLC (Logical Link Control)子层;
* 媒体接入控制 **MAC** (Medium Access Control)子层。

与接入到传输媒体有关的内容都放在 MAC子层，而 LLC 子层则与传输媒体无关。不管采用何种协议的局域网，对 LLC 子层来说都是透明的。

> 由于 TCP/IP 体系经常使用的局域网是 DIX Ethernet V2 而不是 802.3 标准中的几种局域网，因此现在 802 委员会制定的逻辑链路控制子层 LLC(即 802.2 标准)的作用已经不大了。很多厂商生产的适配器上就仅装有 MAC 协议而没有 LLC 协议。

#### 以太网提供的服务
* 以太网提供的服务是不可靠的交付，即**尽最大努力的交付**。
* 当目的站收到有差错的数据帧时就丢弃此帧，其他什么也不做。差错的纠正由高层来决定。
* 如果高层发现丢失了一些数据而进行重传，但以太网并不知道这是一个重传的帧，而是当作一个新的数据帧来发送。

#### 星形拓扑
采用双绞线的以太网采用星形拓扑，在星形的中心则增加了一种可靠性非常高的设备，叫做**集线器** (hub)。
![2.数据链路层+截屏2021-02-02 15.31.22](https://raw.githubusercontent.com/loli0con/picgo/master/images/2.%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%2B%E6%88%AA%E5%B1%8F2021-02-02%2015.31.22.png%2B2021-02-02-15-31-31)

##### 集线器的特点
1. 集线器是使用电子器件来模拟实际电缆线的工作，因此整个系统仍然像一个传统的以太网那样运行。
2. 使用集线器的以太网在逻辑上仍是一个总线网，各工作站使用的还是 CSMA/CD 协议，并共享逻辑上的总线。
3. 集线器很像一个多接口的转发器，工作在物理层。
4. 集线器采用了专门的芯片，进行自适应串音回波抵消，减少了近端串音。
5. 集线器使用了大规模集成电路芯片，因此集线器的可靠性提高。

![2.数据链路层+截屏2021-02-02 15.34.41](https://raw.githubusercontent.com/loli0con/picgo/master/images/2.%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%2B%E6%88%AA%E5%B1%8F2021-02-02%2015.34.41.png%2B2021-02-02-15-34-50)

##### 10BASE-T
![2.数据链路层+截屏2021-02-02 15.38.08](https://raw.githubusercontent.com/loli0con/picgo/master/images/2.%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%2B%E6%88%AA%E5%B1%8F2021-02-02%2015.38.08.png%2B2021-02-02-15-38-19)

* 10BASE-T 的通信距离稍短，每个站到集线器的距离不超过 100 m。这种 10 Mbit/s 速率的无屏蔽双绞线星形网的出现，既降低了成本，又提高了可靠性。
* 10BASE-T 双绞线以太网的出现，是局域网发展史上的一个非常重要的里程碑，它为以太网在局域网中的统治地位奠定了牢固的基础。

#### 以太网的信道利用率
以太网的信道被占用的情况：  
争用期长度为 2t，即端到端传播时延的两倍。检测到碰撞后不发送干扰信号。  
帧长为 L (bit)，数据发送速率为 C (bit/s)，则帧的发送时间为 T0 = L/C (s)。
![2.数据链路层+截屏2021-02-02 15.43.19](https://raw.githubusercontent.com/loli0con/picgo/master/images/2.%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%2B%E6%88%AA%E5%B1%8F2021-02-02%2015.43.19.png%2B2021-02-02-15-43-38)

##### 参数a
在以太网中定义了参数 a，它是以太网单程端到端时延 t 与帧的发送时间 T0 之比：  
**a = t / T0**  
要提高以太网的信道利用率，就必须减小 t 与T0 之比。

对以太网参数 a 的要求是：  
* 当数据率一定时，以太网的连线的长度受到限制，否则 t 的数值会太大。
* 以太网的帧长不能太短，否则 T0 的值会太小，使 a 值太大。

##### 信道利用率的最大值
* 在理想化的情况下，以太网上的各站发送数据都不会产生碰撞(这显然已经不是CSMA/CD，而是需要使用一种特殊的调度方法)，即总线一旦空闲就有某一个站立即发送数据。
* 发送一帧占用线路的时间是 T0 + t，而帧本身的发送时间是T0。于是我们可计算出理想情况下的极限信道利用率Smax为:
![2.数据链路层+截屏2021-02-02 17.11.08](https://raw.githubusercontent.com/loli0con/picgo/master/images/2.%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%2B%E6%88%AA%E5%B1%8F2021-02-02%2017.11.08.png%2B2021-02-02-17-11-30)

#### MAC层
##### MAC地址
在局域网中，硬件地址又称为物理地址，或**MAC地址**。
![2.数据链路层+截屏2021-02-02 17.15.49](https://raw.githubusercontent.com/loli0con/picgo/master/images/2.%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%2B%E6%88%AA%E5%B1%8F2021-02-02%2017.15.49.png%2B2021-02-02-17-15-59)

适配器从网络上每收到一个 MAC 帧就首先用硬件检查 MAC 帧中的 MAC 地址。
* 如果是发往本站的帧则收下，然后再进行其他的处理。
* 否则就将此帧丢弃，不再进行其他的处理。

“发往本站的帧”包括以下三种帧：
* 单播 (unicast) 帧(一对一)
*  广播 (broadcast) 帧(一对全体) 
* 多播 (multicast) 帧(一对多)

##### MAC帧
![2.数据链路层+截屏2021-02-02 17.20.51](https://raw.githubusercontent.com/loli0con/picgo/master/images/2.%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%2B%E6%88%AA%E5%B1%8F2021-02-02%2017.20.51.png%2B2021-02-02-17-21-02)

##### 无效的MAC帧
* 帧的长度不是整数个字节;
* 用收到的帧检验序列 FCS 查出有差错;
* 数据字段的长度不在 46 ~ 1500 字节之间。
* 有效的 MAC 帧长度为 64 ~ 1518 字节之间。

对于检查出的无效 MAC 帧就简单地丢弃。以太网不负责重传丢弃的帧。

##### 帧间最小间隔
* 帧间最小间隔为 9.6 us，相当于 96 bit 的发送时间。
* 一个站在检测到总线开始空闲后，还要等待 9.6 us 才能再次发送数据。
* 这样做是为了使刚刚收到数据帧的站的接收缓存来得及清理，做好接收下一帧的准备。


### 扩展以太网
#### 在物理层扩展以太网
* 使用光纤扩展
* 使用集线器扩展

#### 在数据链路层扩展以太网
* 网桥
* 交换机

##### 以太网交换机
###### 特点
* 以太网交换机实质上就是一个**多接口的网桥**
* 通常都有十几个或更多的接口，每个接口都直接与一个单台主机或另一个以太网交换机相连，并且一般都工作在**全双工方式**。
* 以太网交换机具有**并行性**。能同时连通多对接口，使多对主机能同时通信。
* 相互通信的主机都是独占传输媒体，**无碰撞**地传输数据。
    > 没有碰撞问题， 因此不使用 CSMA/CD 协议。 
* 以太网交换机的接口有存储器，能在输出端口繁忙时把到来的帧进行**缓存**。
* 以太网交换机是一种即插即用设备，其内部的帧交换表(又称为地址表)是通过**自学习算法** 自动地逐渐建立起来的。
* 以太网交换机使用了专用的交换结构芯片，用 硬件转发，其转发速率要比使用软件转发的网 桥快很多。

###### 优点
* **用户独享带宽，增加了总容量**。
* 从共享总线以太网转到交换式以太网时，所有接入设备的软件和硬件、适配器等都不需要做任何改动。
* 以太网交换机一般都具有多种速率的接口，方便了各种不同情况的用户。

###### 自学习
交换机收到一帧后先进行自学习。查找交换表中与收到帧的源地址有无相匹配的项目。
* 如没有，就在交换表中增加一个项目(源地址、进入的接口 和有效时间)。
* 如有，则把原有的项目进行更新(进入的接口或有效时间)。

###### 转发帧
找交换表中与收到帧的目的地址有无相匹配的项目。
* 如没有，则向所有其他接口(进入的接口除外)转发。
* 如有，则按交换表中给出的接口进行转发。
* 若交换表中给出的接口就是该帧进入交换机的接口，则应丢弃这个帧(因为这时不需要经过交换机进行转发)。

###### 生成树算法
![2.数据链路层+截屏2021-02-02 18.25.40](https://raw.githubusercontent.com/loli0con/picgo/master/images/2.%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%2B%E6%88%AA%E5%B1%8F2021-02-02%2018.25.40.png%2B2021-02-02-18-26-13)

EEE 802.1D 标准制定了一个**生成树协议 STP** (Spanning Tree Protocol)。其要点是：不改变网络的实际拓扑，但在逻辑上则切断某些链路，使得从一台主机到所有其他主机的路径是无环路的树状结构，从而消除了兜圈子现象。

生成树算法：
1. 选一个树根（优先依据交换机的优先级参数，谁小谁优先；如果所有交换机的优先级都相同，则根据MAC地址，谁小谁优先。）
2. 确定**根端口**，在其他的交换机上离根交换机最近的端口就是根端口
3. 确定**指定端口**，查看所有连线（网线），距离根比较近的一端就是指定端口
4. 又不是根端口又不是指定端口，则该端口被阻断

#### 虚拟局域网
* 虚拟局域网 VLAN 是由一些局域网网段构成的与物理位置无关的逻辑组，而这些网段具有某些共同的需求。每一个 VLAN 的帧都有一个明确的标识符，指明发送这个帧的计算机是属于哪一个 VLAN。  
* 虚拟局域网其实只是局域网给用户提供的一种服务，而并不是一种新型局域网。
* 利用以太网交换机可以很方便地实现虚拟局域网VLAN。

![2.数据链路层+截屏2021-02-02 19.01.40](https://raw.githubusercontent.com/loli0con/picgo/master/images/2.%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%2B%E6%88%AA%E5%B1%8F2021-02-02%2019.01.40.png%2B2021-02-02-19-01-52)

##### 帧格式
* IEEE 批准了 802.3ac 标准，该标准定义了以太网的帧格式的扩展，以支持虚拟局域网。
* 虚拟局域网协议允许在以太网的帧格式中插入一个4字节的标识符，称为 VLAN 标记 (tag)， 用来指明发送该帧的计算机属于哪一个虚拟局域网。
* 插入 VLAN 标记得出的帧称为 802.1Q 帧或带标记的以太网帧。

![2.数据链路层+截屏2021-02-02 19.13.54](https://raw.githubusercontent.com/loli0con/picgo/master/images/2.%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%2B%E6%88%AA%E5%B1%8F2021-02-02%2019.13.54.png%2B2021-02-02-19-14-06)

#### 高速以太网
##### 100BASE-T以太网
* 可在全双工方式下工作而无冲突发生。在全双工方式下工作时，不使用 CSMA/CD 协议。
* MAC 帧格式仍然是 802.3 标准规定的。
* 保持最短帧长不变，但将一个网段的最大电缆长度减小到 100 m。
* 帧间时间间隔从原来的 9.6 us 改为现在的 0.96 us。

##### 吉比特以太网
* 允许在 1 Gbit/s 下以全双工和半双工两种方式工作。
* 在半双工方式下使用 CSMA/CD 协议，全双工方式不使用 CSMA/CD 协议。
* 使用 IEEE 802.3 协议规定的帧格式。
* 与 10BASE-T 和 100BASE-T 技术向后兼容。

##### 端到端的以太网传输
以太网的工作范围已经从局域网(校园网、企业网)扩大到城域网和广域网，从而实现了端到端的以太网传输。  
这种工作方式的好处有：
* 技术成熟;
* 互操作性很好;
* 在广域网中使用以太网时价格便宜;
* 采用统一的以太网帧格式，简化了操作和管理。

##### 使用以太网进行宽带接入
以太网宽带接入具有以下特点:
* 可以提供双向的宽带通信。
* 可以根据用户对带宽的需求灵活地进行带宽升级。
* 可以实现端到端的以太网传输，中间不需要再进行帧格式的转换。这就提高了数据的传输效率且降低了传输的成本。
* 但是不支持用户身份鉴别。

###### PPPoE
PPPoE (PPP over Ethernet) 的意思是“在以太网上运行PPP”，它把 PPP 协议与以太网协议结合起来 —— 将 PPP 帧再封装到以太网中来传输。
* 现在的光纤宽带接入 FTTx 都要使用 PPPoE 的方式进行接入。在 PPPoE 弹出的窗口中键入在网络运营商购买的用户名和密码，就可以进行宽带上网了。
* 利用 ADSL 进行宽带上网时，从用户个人电脑到家中 的 ADSL 调制解调器之间，也是使用 RJ-45 和 5 类线 (即以太网使用的网线)进行连接的，并且也是使用 PPPoE 弹出的窗口进行拨号连接的。
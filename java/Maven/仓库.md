# 仓库
在Maven中，任何一个*依赖*、*插件*或者*项目构建的输出*，都可以称之为**构件**。在Maven的术语中，**仓库**是一个位置（place），它用于存放上述的这些**构件**。

Maven仓库类型：
|仓库类型|存储位置|作用|访问优先级|
|---|---|---|---|
|***本地仓库***|用户目录下的.m2/repository|缓存远程下载的依赖|1|
|**远程仓库**|网络服务器|提供依赖和插件的集中存储|2|
|- *中央仓库*|repo.maven.apache.org|Maven官方维护的默认仓库|2.1|
|- *私服仓库*|公司内部搭建（如Nexus）|托管私有依赖，加速构建|2.2|
|- *其他公共仓库*|如阿里云、JCenter等|镜像或补充中央仓库|2.3|

## 本地仓库
Maven的本地仓库，在安装Maven后并不会创建，它是在第一次执行maven命令的时候才被创建。

运行Maven的时候，Maven所需要的任何构件都是直接从本地仓库获取的。如果本地仓库没有，它会首先尝试从远程仓库下载构件至本地仓库，然后再使用本地仓库的构件。

Maven本地仓库默认被创建在%USER_HOME%目录下（~/.m2/repository）。要修改默认位置，在%MAVEN_HOME%\conf目录中的 Maven的settings.xml文件中定义另一个路径。
```xml
<settings>
    <localRepository>C:/MyLocalRepository</localRepository>
</settings>
```

一个构件只有存在本地仓库后才能被 Maven 项目使用。将构件保存到本地仓库最常见的有两种方式，一种是以依赖的形成，从远程仓库下载到本地仓库；另一种是将本地项目编译打包后，安装到本地仓库。

不推荐把自己的模块安装到Maven的本地仓库，因为每次修改某个模块的源码，都需要重新安装（否则本地仓库里面的代码就是修改前的代码了），非常容易出现版本不一致的情况。

## 中央仓库
Maven中央仓库是由Maven社区提供的仓库，其中包含了大量常用的库。

中央仓库包含了绝大多数流行的开源Java构件，以及源码、作者信息、SCM、信息、许可证信息等。一般来说，简单的Java项目依赖的构件都可以在这里下载到。

## 远程仓库
如果Maven在中央仓库中也找不到依赖的文件，它会停止构建过程并输出错误信息到控制台。为避免这种情况，Maven提供了远程仓库的概念，它是开发人员自己定制仓库，包含了所需要的代码库或者其他工程中用到的jar文件。

举例说明，使用下面的pom.xml，Maven将从远程仓库中下载该pom.xml中声明的所依赖的（在中央仓库中获取不到的）文件。

```xml
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <groupId>com.companyname.projectgroup</groupId>
    <artifactId>project</artifactId>
    <version>1.0</version>
    
    <!-- 远程仓库配置 -->
    <repositories>
        <!-- 远程仓库1 -->
        <repository>
            <id>companyname.lib1</id>
            <url>http://download.companyname.org/maven2/lib1</url>
        </repository>
        <!-- 远程仓库2 -->
        <repository>
            <id>companyname.lib2</id>
            <url>http://download.companyname.org/maven2/lib2</url>
            <!-- 使用RELEASE版本 -->
            <releases>
                <enabled>true</enabled>
            </releases>
            <!-- 禁用SNAPSHOT版本 -->
            <snapshots>
                <enabled>false</enabled>
            </snapshots>
        </repository>
    </repositories>
</project>
```
在pom.xml中可以配置多个仓库，每个仓库的id都要是唯一的。而且需要注意的是，在Maven的Super-POM中，已经默认配置了一个中央仓库，它的id为central。

## 镜像仓库
如果*仓库A*能提供*仓库B*存储的所有服务，那么就把*A*叫作*B*的镜像。  

由于地理位置的因素，该镜像往往能够提供比中央仓库更快的服务。所以，为了提高Maven效率，可以通过配置文件用镜像代替中央仓库。

```
           slow    ┌───────────────────┐
    ┌─────────────▶│Maven Central Repo.│
    │              └───────────────────┘
    │                        │
    │                        │sync
    │                        ▼
┌───────┐  fast    ┌───────────────────┐
│ User  │─────────▶│Maven Mirror Repo. │
└───────┘          └───────────────────┘
```

修改%MAVEN_HONE%/conf/settings.xml文件，在mirrors元素上添加内容如下：
```xml
<mirrors>
    <mirror>
        <id>aliyun</id>
        <name>Aliyun Mirror</name>
        <!-- 镜像仓库地址 -->
        <url>https://maven.aliyun.com/repository/central</url>
        <!-- 镜像仓库类型：覆盖中央仓库 -->
        <mirrorOf>central</mirrorOf>
    </mirror>
</mirrors>
```

## 私服仓库
仓库类型：
|仓库类型|用途|
|---|---|
|hosted|存放私有构件|
|proxy|代理远程仓库|
|group|聚合多个仓库|

### 发布到私服
在pom.xml中配置：
```xml
<distributionManagement>
    <repository>
        <id>nexus-releases</id>
        <url>http://your-nexus/repository/maven-releases</url>
    </repository>
    <snapshotRepository>
        <id>nexus-snapshots</id>
        <url>http://your-nexus/repository/maven-snapshots</url>
    </snapshotRepository>
</distributionManagement>
```

在%MAVEN_HONE%/conf/settings.xml中配置认证：
```xml
<servers>
    <server>
        <id>nexus-releases</id>
        <username>deploy-user</username>
        <password>deploy-pwd</password>
    </server>
</servers>
```

## 依赖搜索顺序
当我们执行Maven构建命令时，Maven开始按照以下顺序查找依赖的库：
1. 在本地仓库中搜索，如果找不到，执行*步骤2*，如果找到了则执行其他操作。
2. 在中央仓库中搜索，如果找不到，并且有一个或多个远程仓库已经设置，则执行*步骤4*，如果找到了则下载到本地仓库中以备将来引用。
3. 如果远程仓库没有被设置，Maven 将简单的停滞处理并抛出错误（无法找到依赖的文件）。
4. 在一个或多个远程仓库中搜索依赖的文件，如果找到则下载到本地仓库以备将来引用，否则Maven将停止处理并抛出错误（无法找到依赖的文件）。


## 仓库搜索服务
在实际开发过程中，用户可能只知道需要使用的构件项目名称，但是在Maven依赖配置中，一定要指定详细的坐标信息。这时候，就可以使用仓库的搜索服务，根据构件的关键字来查找Maven的详细坐标。

一个常用的Maven仓库搜索服务：[MVNRepository](https://mvnrepository.com/)。它提供基于关键字搜索、依赖声明代码片段、构件下载、构件所包含信息等功能。
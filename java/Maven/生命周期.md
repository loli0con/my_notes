# 生命周期
在Maven之前，项目构建的生命周期概念就已经存在了。软件开发人员每天都要对项目进行清理、编译、测试、打包以及安装部署。通过学习、分析、反思和总结已有的项目的构建过程，Maven抽象出了一个适合于所有项目的**生命周期(lifecycle)**。

Maven构建生命周期定义了一个项目*构建*和*发布*的流程，每个生命周期又包含了多个**阶段(phase)**，这些阶段在执行的时候是**有固定顺序**的，**后面的阶段一定要等前面的阶段执行完成后才能被执行**。

## 三个标准的生命周期
Maven拥有三套独立的生命周期，它们分别是：
* **clean**生命周期负责清理项目；
* **default**生命周期负责构建项目；
* **site**生命周期负责建立项目站点。

![20251215161819](https://raw.githubusercontent.com/loli0con/picgo/master/20251215161819.png)

### clean 生命周期
clean生命周期的目的是清理项目，它包括以下三个阶段：
1. pre-clean：执行清理前需要完成的工作。
2. clean：清理上一次构建过程中生成的文件，比如编译后的class文件等。
3. post-clean：执行清理后需要完成的工作。

### default 生命周期
default生命周期定义了构建项目时所需要的执行步骤，它是所有生命周期中最核心部分，包含的阶段如下表所述，比较常用的阶段用粗体标记。
|**阶段phase**名称|说明|
|-----|-----|
|validate（校验）|验证项目结构是否正常，必要的配置文件是否存在|
|initialize（初始化）|做构建前的初始化操作，比如初始化参数、创建必要的目录等|
|generate-sources（生成源代码）|产生在编译过程中需要的源代码|
|process-sources（处理源代码）|处理源代码，比如过滤值|
|generate-resources（生成资源文件）|生成将会包含在项目包中的资源文件|
|process-resources（处理资源文件）|	复制和处理资源到目标目录，为打包阶段最好准备|
|**compile（编译）**|编译项目中的源代码|
|process-classes（处理类文件）|处理编译生成的文件，比如说对Java class文件做字节码改善优化|
|generate-test-sources（生成测试源代码）|产生编译过程中测试相关的代码|
|process-test-sources（处理测试源代码）|处理测试源代码，比如说，过滤任意值|
|generate-test-resources（生成测试资源文件）|为测试创建资源文件|
|process-test-resources（处理测试资源文件）|复制和处理测试资源到目标目录|
|test-compile（编译测试源码）|编译测试源代码到测试目标目录|
|process-test-classes（处理测试类文件）|处理测试源码编译生成的文件|
|**test（测试）**|使用合适的单元测试框架运行测试（Juint是其中之一）|
|prepare-package（准备打包）|处理打包前需要初始化的准备工作|
|**package（打包）**|将编译后的 class 和资源打包成可分发格式的文件，比如JAR、WAR或者EAR文件|
|pre-integration-test（集成测试前）|做好集成测试前的准备工作，比如集成环境的参数设置|
|integration-test（集成测试）|处理和部署项目到可以运行集成测试环境中|
|post-integration-test（集成测试后）|完成集成测试后的收尾工作，比如清理集成环境的值|
|verify（验证）|运行任意的检查来验证项目包有效且达到质量标准|
|**install（安装）**|将打包的组件以构件的形式，安装到本地依赖仓库中，以便共享给本地的其他项目，用作其他本地项目的依赖|
|**deploy（部署）**|将最终的项目包复制到远程仓库中与其他开发者和项目共享|

这些阶段的详细介绍内容可以参考链接：  
http://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html

### site 生命周期
site生命周期的目的是建立和发布项目站点。Maven可以基于pom所描述的信息自动生成项目的站点，同时还可以根据需要生成相关的报告文档集成在站点中，方便团队交流和发布项目信息。site生命周期包括如下阶段：
1. pre-site：执行生成站点前的准备工作。
2. site：生成站点文档。
3. post-site：执行生成站点后需要收尾的工作。
4. site-deploy：将生成的站点发布到服务器上。

## 生命周期和插件
**构建生命周期只是Maven根据实际情况提炼出来的*标准和规范***，是一个抽象的概念。Maven只是规定了生命周期的各个阶段和步骤，**具体事情，由集成到Maven中的插件完成**。比如[前面](项目.md#创建项目)在命令行创建项目时，实际是由maven-archetype-quickstart插件完成的。

一个插件可以包含一个或多个**目标(goal)**，每个**目标**代表该插件的一项功能。在构建和管理项目的过程中，**插件目标**将负责指派给它的任务。**插件目标**可能被绑定到多个阶段或者无绑定。不绑定到任何构建阶段的目标可以在构建生命周期之外通过直接调用执行。这些目标的执行顺序取决于调用目标和构建阶段的顺序。

例如，命令`mvn clean dependency:copy-dependencies package`，其中`clean`和`pakage`是构建阶段(phase)，`dependency:copy-dependencies`是目标(goal)：
1. clean阶段将会被首先执行（包括前置的pre-clean阶段也会被执行）
2. 然后 dependency:copy-dependencies目标会被执行
3. 最终package阶段被执行（包括前置的validate到prepare-package共计16个阶段也会被执行）

## 命令行调用
执行maven命令必须进入到pom.xml的目录中进行执行，通过这些命令可以让Maven执行生命周期的特定阶段。常用命令如下：
1. mvn clean：清理，这个命令可以用来清理已经编译好的文件
2. mvn compile：编译主程序，将Java代码编译成class文件
3. mvn test：执行单元测试测试，打印测试结果
4. mvn package：打包，根据用户的配置将项目打成jar包或者war包
5. mvn install：安装，手动向本地仓库安装一个jar包供其他项目共享使用

当一个阶段通过Maven命令调用时，该阶段之前以及包括该阶段在内的所有阶段会被执行，因此我们只需要调用最后一个阶段即可。
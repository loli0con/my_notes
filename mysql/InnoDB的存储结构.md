# InnoDB的存储结构

## 数据库的存储结构：页
索引结构给我们提供了高效的索引方式，不过索引信息以及数据记录都是保存在文件上的，确切说是存储在页结构中的。

### 磁盘与内存交互的基本单位：页
InnoDB将数据划分为若干个页，InnoDB中页的大小默认为**16KB**。

以**页**作为磁盘和内存之间交换的**基本单位**，也就是一次最少从磁盘中读取16KB的内容到内存中，一次最少把内存中的16KB内容刷新到磁盘中。**也就是说，在数据库中，不论读一行，还是读多行，都是将这些行所在的页进行加载。也就是说。数据库管理存储空间的基本单位是页（Page），数据库I/O操作的最小单位也是页。**一个页中可以存储多个行记录。

![InnoDB的存储结构+20240306172344](https://raw.githubusercontent.com/loli0con/picgo/master/images/InnoDB的存储结构+20240306172344.png+2024-03-06-17-23-45)

### 页结构概述
*页a、页b、页c...页n*这些页可以**不在物理结构上相连**，只要通过**双向链表**相关联即可。每个数据页中的记录会按照主键值从小到大的顺序组成一个**单向链表**，每个数据页都会为存储在它里边的记录生成一个**页目录**，在通过主键查找某条记录的时候可以在页目录中**使用二分法**快速定位到对应的槽，然后再遍历该槽对应分组中的记录即可快速找到指定的目录。

### 页的大小
不同的数据库管理系统（简称DBMS）的页大小不同。比如在MySQL的InnoDB存储引擎中，默认页的大小是**16KB**，可以通过下面的命令来进行查看：
```SQL
show variables like '%innodb_page_size%';
+------------------+-------+
| Variable_name    | Value |
+------------------+-------+
| innodb_page_size | 16384 |
+------------------+-------+
1 row in set (0.02 sec)
```
> 1KB = 1024B, 16KB = 16384B

### 页的上层结构
另外在数据库中，还存在着区（Extent）、段（Segment）和表空间（Tablespace）的概念。行、页、区、段、表空间的关系如下图所示：
![InnoDB的存储结构+20240306174011](https://raw.githubusercontent.com/loli0con/picgo/master/images/InnoDB的存储结构+20240306174011.png+2024-03-06-17-40-12)

**区（Extent）**是比页大一级的存储结构，在InnoDB存储引擎中，一个区会分配**64个连续的页**。因为InnoDB中的页大小默认是16KB，所以一个区的大小是64*16KB=**1MB**。

**段（Segment）**由一个或者多个区组成，区在文件系统内是一个连续分配的空间（在InnoDB中是连续的64个页），不过在段中不要求区与区之间是相邻的。**段是数据库中的分配单位，不同的类型的数据库对象以不同的段形式存在。**当我们创建数据表、索引的时候，就会相应创建对应的段，比如创建一张表时会创建一个表段，创建一个索引时会创建一个索引段。

**表空间（Tablespace）**是一个逻辑容器，表空间存储的对象是段，在一个表空间中可以有一个或多个段，但是一个段只能属于一个表空间。数据库由一个或者多个表空间组成，表空间从管理上可以划分为**系统表空间**、**用户表空间**、**撤销表空间**、**临时表空间**等。